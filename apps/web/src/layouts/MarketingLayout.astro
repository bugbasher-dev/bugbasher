---
import Footer from '~/components/Footer.astro'
import Header from '~/components/Header.astro'
import Banner from '~/components/Banner.astro'
import '../styles/tailwind.css'
import { getThemeFromCookie } from '~/utils/theme'
import { fetchBannerData } from '~/lib/fetchBanner'

// Get theme from cookie
const cookieHeader = Astro.request.headers.get('cookie')
const theme = getThemeFromCookie(cookieHeader)

// Check if banner is enabled
const banner = await fetchBannerData()
const isBannerEnabled = banner?.isEnabled ?? false

// CMS URL for resource hints
const cmsUrl = (import.meta as any).env?.PUBLIC_CMS_URL || ''
const cmsOrigin = cmsUrl ? new URL(cmsUrl).origin : null
---

<html class={theme} lang="en" dir="ltr">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<!-- Preconnect to CMS for images and API calls -->
		{cmsOrigin && (
			<>
				<link rel="preconnect" href={cmsOrigin} crossorigin />
				<link rel="dns-prefetch" href={cmsOrigin} />
			</>
		)}

		<!-- Preconnect to external CDN for logo images -->
		<link rel="preconnect" href="https://cdn.magicui.design" crossorigin />
		<link rel="dns-prefetch" href="https://cdn.magicui.design" />


		<!-- Favicons -->
		<link rel="icon" href="/favicon.ico" sizes="48x48" />
		<link rel="icon" type="image/svg+xml" href="/favicons/favicon.svg" />
		<link rel="apple-touch-icon" href="/favicons/apple-touch-icon.png" />
		<link rel="manifest" href="/site.webmanifest" crossorigin="use-credentials" />

		<slot name="head" />
	</head>
	<body>
		<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-background focus:px-4 focus:py-2 focus:rounded">Skip to main content</a>
		<Banner />
		<Header bannerEnabled={isBannerEnabled} />
		<main id="main-content" class={isBannerEnabled ? 'mt-16 max-w-screen' : 'mt-16 max-w-screen'}>
			<slot />
		</main>

		<!-- Footer -->
		<div class="dark">
			<Footer />
		</div>
	</body>
</html>

