---
import GridDesign from './GridDesign.astro'
import Badge from './ui/Badge.astro'
import Button from './ui/Button.astro'

const CMS_URL = (import.meta as any).env?.PUBLIC_CMS_URL

interface Props {
	type?: string
	richText?: any
	media?: any
	links?: any[]
	videoUrl?: string
	isClosedBeta?: boolean
}

const { type, richText, media, links, videoUrl, isClosedBeta } = Astro.props

// Enhanced content renderer for Lexical content with better styling
const renderLexicalContent = (content: any) => {
	if (!content || !content.root || !content.root.children) {
		return ''
	}

	return content.root.children
		.map((node: any) => {
			if (node.type === 'paragraph' && node.children) {
				const text = node.children
					.map((child: any) => {
						if (child.format && child.format > 0) {
							let formattedText = child.text || ''
							if (child.format & 1)
								formattedText = `<strong class="font-semibold">${formattedText}</strong>`
							if (child.format & 2)
								formattedText = `<em class="italic">${formattedText}</em>`
							return formattedText
						}
						return child.text || ''
					})
					.join('')
				return `<p class="text-xl text-muted-foreground leading-relaxed max-w-[600px]">${text}</p>`
			}
			if (node.type === 'heading' && node.children) {
				const text = node.children
					.map((child: any) => child.text || '')
					.join('')
				return `<h1 class="text-4xl md:text-6xl lg:text-7xl tracking-tight font-title text-foreground leading-tight">${text}</h1>`
			}
			return ''
		})
		.join('')
}
---

<section class="relative w-full py-16 md:py-24 overflow-hidden">
	<!-- Grid Design Background -->
	<GridDesign />

	<div class="container relative px-4 md:px-10">
		<div class="lg:flex lg:gap-8">
			<div class="mx-auto max-w-2xl lg:mx-0 lg:shrink-0 md:pt-8">
				<div class="space-y-6">
					<Badge variant="outline" size="sm">
						// BY THE MAKERS OF BUGBASHES.DEV
					</Badge>
					{
						richText && (
							<div
								class="space-y-6"
								set:html={renderLexicalContent(richText)}
							/>
						)
					}
				</div>

				{
					!isClosedBeta && links && links.length > 0 && (
						<div class="flex flex-wrap items-center gap-3 mt-8">
							<Button href={links[0]?.url || '#'} variant="default" size="lg">
								{links[0]?.link?.label || 'Get started'}
							</Button>
							{links[1] && (
								<Button href={links[1]?.url || '#'} variant="outline" size="lg">
									{links[1]?.link?.label || 'Learn more'}
								</Button>
							)}
						</div>
					)
				}
			</div>

			{
				media && (
					<div class="mx-auto mt-16 flex max-w-xl sm:mt-24 lg:mt-0 lg:mr-0 lg:ml-8 lg:max-w-none lg:flex-none xl:ml-16">
						<div class="max-w-2xl flex-none sm:max-w-3xl lg:max-w-none">
							<div class="-m-2 bg-muted p-1 ring-1 ring-white/10 ring-inset lg:-m-4 lg:p-2">
								<img
									src={`${CMS_URL}${media.url}`}
									alt={media.alt || 'Hero image'}
									width={media.width || 2432}
									height={media.height || 1442}
									class="w-full max-h-[35rem] object-cover"
								/>
							</div>
						</div>
					</div>
				)
			}
		</div>
	</div>
</section>
