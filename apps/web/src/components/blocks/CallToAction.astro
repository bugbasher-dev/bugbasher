---
import Button from '../ui/Button.astro'
import GridDesign from '../GridDesign.astro'

interface Props {
	richText?: any
	links?: any[]
	blockType: 'cta'
}

const { richText, links } = Astro.props

// Simple content renderer for Lexical content
const renderLexicalContent = (content: any) => {
	if (!content || !content.root || !content.root.children) {
		return ''
	}

	return content.root.children
		.map((node: any) => {
			if (node.type === 'paragraph' && node.children) {
				const text = node.children
					.map((child: any) => child.text || '')
					.join('')
				return `<p class="text-lg text-muted-foreground leading-relaxed">${text}</p>`
			}
			if (node.type === 'heading' && node.children) {
				const text = node.children
					.map((child: any) => child.text || '')
					.join('')
				const tag = node.tag === 'h1' ? 'h2' : node.tag || 'h2'
				const headingClass = 'text-3xl md:text-5xl font-title text-foreground mb-4'
				const idAttr = tag === 'h2' ? ' id="cta-heading"' : ''
				return `<${tag}${idAttr} class="${headingClass}">${text}</${tag}>`
			}
			return ''
		})
		.join('')
}
---

<section class="relative w-full py-20 md:py-28" aria-labelledby="cta-heading">
	<GridDesign aria-hidden="true" />
	<div class="container relative mx-auto px-4 text-center">
		<div class="max-w-4xl mx-auto">
			<div class="bg-muted dark:bg-background rounded-2xl p-1">
				<div
					class="bg-card ring-border rounded-2lg p-8 md:p-12 shadow-sm ring-1"
				>
					{
						richText && (
							<div class="prose prose-lg max-w-none mb-8 space-y-4">
								<div set:html={renderLexicalContent(richText)} />
							</div>
						)
					}

					{
						links && links.length > 0 && (
							<div class="flex flex-wrap justify-center gap-3 mt-8">
								{links.map((link, index) => (
									<Button
										href={link.url || '#'}
										variant={index === 0 ? 'default' : 'secondary'}
										size="lg"
										aria-label={link.label || 'Call to action'}
									>
										{link.label}
									</Button>
								))}
							</div>
						)
					}
				</div>
			</div>
		</div>
	</div>
</section>
